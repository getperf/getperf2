エージェント
============

概要
----

* 使用言語はGoで統一する
* クラスターソフトを導入する。Hashi corp Consul を想定
* マネージャー、スケジューラとの通信は Resty ライブラリ による REST を想定

機能仕様
--------

機能要件
~~~~~~~~

* 基本機能
    * ログ送付
        * 採取データの送信
    * Zip圧縮
    * スケジューラ
        * タグによる対象の絞り込み
    * コレクター管理
       * 各プラットフォームの検査シナリオ（コマンドなど）
    * セッション管理
       * 検査対象の接続情報の管理
* テンプレート機能
    * 各メトリックのデータ収集コマンド実行
        * HW/OS
        * FW
        * LAN

非機能要件
~~~~~~~~~~

* 分散データベース
    * ノード間で情報を共有
        * ノードのロール、検査対象の接続情報など
    * キーバリュー値にノード情報セット
* バージョン管理
    * 本体、テンプレートのバージョンアップ更新
* プロセス管理
    * サービスの自動起動
* イベント処理
    * モジュールのダウンロード、自動更新
    * インベントリ収集
        * 定期収集と連動する
* 監視
    * プロセスステータスの検知
    * マネージャ、サーバの検知

データモデル
------------

* イベント設定
   * 自動更新設定
   * 収集設定
* ノード設定
   * ロール
   * 採取プラットフォームリスト
   * リモート採取対象ノードリスト
* バージョン情報
   * ベース、各テンプレートのバージョン
* セキュリティ情報
   * 接続情報

Consul インテグレーション
-------------------------

以下項目を検討し、 Consul 非機能要件部を具体化する

* セキュリティ対策
    * セキュアな通信、 Connect ルート設定
    * 接続情報の暗号化
* 管理プロセスがない場合の動作設定
    * なければ何もしない、ログも出さない
    * サーバーか、Tool本体にサーバを入れる
* Consul 構成／設定
    * Consul ウォッチの設定
        * 本体、テンプレートの自動更新
        * 絞り込みを可能にする収集コマンドリスト定義
             * ノード
             * プラットフォーム
             * メトリック
    * アクション設定
        * サービス再起動
        * データ収集、データ送信
    * プロセス構成
        * Consul + Agent
        * Consul + ファイル送受信 + Agent
* ノードを削除した場合の動作
