ネットワーク
============

要件の整理
----------

* ネットワーク環境は以下の3パターン

   - Frontier network：監視対象は異なるネットワーク環境にあり、遮断されている。都度、現地で情報採取する
   - LAN：監視対象、サーバ、フロントツールはLANからアクセスできる
   - WAN：監視対象との通信はプロキシーを経由する必要がある

* インベントリ採取

   - ローカル採取
   
      エージェントを入れて実行する。リモートで情報が採取できない場合に使用。例えば、WinRMのアクセス制限がされている場合、リモートアクセスできないファイル、コマンドを実行する場合など。
      フロントとエージェントの疎通はできること。エージェントはセッション接続をせずに直接実行する。実行結果をフロントに転送する。エージェントは検査対象に近いエッジ、同じサーバ上に配置させる

   - リモート採取
      
      フロントツール、エージェントは共存させる。リモートで監視対象にアクセスして情報採取をする。セッションを確立してからローカルと同等の採取を実行。監視対象は複数台を想定する。実行結果の構成は同じにして、後続処理の解析処理はローカル採取と共通化する

* 定期実行
   
   フロントツールを介さず。エージェント、サーバ間で定期的に情報収集、解析、登録を行う。監視設定の定期情報採取。ウィルス対策ソフトのパターンファイルなど更新頻繁の高い情報の採取に使用する

* 暗号化

   agent, front, server 間の通信はSSLなどセキュアな通信に限定する。
   自己署名の証明書を利用するなどして証明書への匿名を管理し、許可されたノードのみが
   アクセスできるようにする。

ネットワーク構成
----------------

* パターン1(ベース)

   全てLAN内にある。target/agent <-> front <-> server

* パターン2(スポット実行)

   サーバなし。target/agent <-> front または、 target <-> agent/front

* パターン３(辺境)

   * 異なるネットワーク環境で遮断されている
   * target/agent <-> front ⇒(後ほど) front <-> server

* パターン4(WAN)

   * プロキシー経由でアクセスする
   * target/agent <-> proxy <-> front <-> server

* パターン5(フロントなし)

   * target/agent  <->  server
   * 運用フェーズの環境で、 front はスポットで target,server にアクセスする

クラスター管理ツールとの連携
----------------------------

Consul などのツール連携を検証

* 自動配布機能
   * 構成ファイルの自動収集機能
   * エージェントの操作を介さない
   * 設定のリロード
* Consul が既に入っている場合の対応の考慮
   * 既存Consulにサービス追加。設定がバッティングしない構成の検討
   * 別インスタンスの Consul との共存
* 定期スケジュール
   * エージェント/フロント、エージェント/サーバ間のファイル転送

